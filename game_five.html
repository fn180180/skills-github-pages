<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ±ºæˆ°ï¼äº”å­æ£‹</title>
<style>
#header {
text-align: center;
font-size: 32px;
color: #b22222;
margin: 20px 0;
text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}
#rules {
max-width: 600px;
margin: 20px auto;
padding: 15px;
background: #fff;
border-radius: 8px;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
body {
display: flex;
flex-direction: column;
align-items: center;
font-family: "Microsoft JhengHei", Arial, sans-serif;
background: #f0f0f0;
margin: 0;
padding: 10px;
}
#board {
border-collapse: collapse;
background: #e6a23c; /* æ£‹ç›¤é¡è‰²èª¿æ·± */
margin: 10px auto;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
td {
width: 50px;
height: 50px;
border: 1px solid #8b4513;
text-align: center;
font-size: 18px;
font-weight: bold;
color: #333;
position: relative;
cursor: pointer;
}
.black {
position: relative;
}
.black::after {
content: '';
width: 36px;
height: 36px;
border-radius: 50%;
background: #000;
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: 2;
}
.white {
position: relative;
}
.white::after {
content: '';
width: 36px;
height: 36px;
border-radius: 50%;
background: #fff;
box-shadow: 0 0 5px rgba(0,0,0,0.3);
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: 2;
}
.move-number {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
font-size: 12px;
z-index: 3;
}
.black .move-number { color: white; }
.white .move-number { color: black; }
.mark::before {
content: '';
width: 12px;
height: 12px;
border-radius: 50%;
background: #ff0000;
position: absolute;
top: 4px;
right: 4px;
z-index: 3;
box-shadow: 0 0 3px white;
border: 2px solid white;
}
.preview::after {
content: '';
width: 36px;
height: 36px;
border: 3px solid rgba(33, 150, 243, 0.8);
border-radius: 50%;
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: 1;
animation: pulse 1.5s infinite;
box-shadow: 0 0 8px rgba(33, 150, 243, 0.5);
}
@keyframes pulse {
0% {
transform: translate(-50%, -50%) scale(0.9);
opacity: 0.8;
}
50% {
transform: translate(-50%, -50%) scale(1.15);
opacity: 1;
}
100% {
transform: translate(-50%, -50%) scale(0.9);
opacity: 0.8;
}
}
#status {
font-size: 24px;
margin: 10px;
color: #333;
}
#controls {
display: flex;
gap: 15px;
margin-bottom: 15px;
flex-wrap: wrap;
justify-content: center;
}
#controls button {
padding: 12px 24px;
font-size: 18px;
cursor: pointer;
color: white;
border: none;
border-radius: 6px;
transition: opacity 0.3s;
}
#controls button.undo {
background: #ff4444;
}
#controls button.reset {
background: #2196F3;
}
#markToggle {
background: #ff0000;
}
#forbiddenToggle {
background: #3f51b5;
}
#timerToggle {
background: #4CAF50;
}
#pauseResumeTimer {
background: #FF9800;
}
/* è¨ˆæ™‚å™¨æ¨£å¼ */
#timer-container {
display: flex;
gap: 30px;
margin: 15px 0;
align-items: center;
}
.timer-box {
background: white;
border-radius: 10px;
padding: 15px 20px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
text-align: center;
min-width: 120px;
}
.timer-label {
font-size: 16px;
font-weight: bold;
margin-bottom: 5px;
}
.timer-time {
font-size: 24px;
font-weight: bold;
font-family: 'Courier New', monospace;
}
.black-timer .timer-label { color: #000; }
.white-timer .timer-label { color: #666; }
.black-timer.active { border: 3px solid #000; }
.white-timer.active { border: 3px solid #666; }
.timer-low { color: #ff0000 !important; }
/* ç‚¸å½ˆæ¨£å¼ */
.forbidden::before {
content: 'ğŸ’£';
font-size: 30px;
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: 4;
animation: bomb-pulse 1s infinite;
filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
}
@keyframes bomb-pulse {
0% {
transform: translate(-50%, -50%) scale(1);
}
50% {
transform: translate(-50%, -50%) scale(1.2);
}
100% {
transform: translate(-50%, -50%) scale(1);
}
}
/* ç¦æ‰‹æ£‹å­æ¨£å¼ - åŠé€æ˜é»‘æ£‹ */
.forbidden-stone::after {
content: '';
width: 36px;
height: 36px;
border-radius: 50%;
background: rgba(0, 0, 0, 0.4); /* åŠé€æ˜é»‘è‰² */
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: 2;
border: 2px solid rgba(255, 0, 0, 0.8); /* ç´…è‰²é‚Šæ¡† */
}
.forbidden-stone .move-number {
color: rgba(255, 255, 255, 0.8);
}
button:hover {
opacity: 0.8;
}
@media (max-width: 600px) {
td {
width: 30px;
height: 30px;
font-size: 14px;
}
.black::after, .white::after {
width: 22px;
height: 22px;
}
.preview::after {
width: 22px;
height: 22px;
border-width: 2px;
box-shadow: 0 0 5px rgba(33, 150, 243, 0.5);
}
.mark::before {
width: 8px;
height: 8px;
top: 3px;
right: 3px;
}
.move-number {
font-size: 10px;
}
#status {
font-size: 20px;
}
button {
padding: 10px 20px;
font-size: 16px;
}
.forbidden::before {
font-size: 20px;
}
.forbidden-stone::after {
width: 22px;
height: 22px;
}
#timer-container {
gap: 15px;
}
.timer-box {
padding: 10px 15px;
min-width: 100px;
}
.timer-time {
font-size: 18px;
}
}
/* æ–°å¢çš„é€£ç·šé«˜äº®å’Œç…™ç«æ•ˆæœæ¨£å¼ */
.winning-stone::after {
box-shadow: 0 0 10px 5px gold !important;
animation: pulse-win 1s infinite !important;
}
@keyframes pulse-win {
0% {
transform: translate(-50%, -50%) scale(0.9);
box-shadow: 0 0 10px 5px gold;
}
50% {
transform: translate(-50%, -50%) scale(1.1);
box-shadow: 0 0 15px 8px gold;
}
100% {
transform: translate(-50%, -50%) scale(0.9);
box-shadow: 0 0 10px 5px gold;
}
}
.firecracker-container {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: 1000;
}
.firecracker-particle {
position: absolute;
width: 8px;
height: 8px;
border-radius: 50%;
animation: firecracker 1.5s ease-out forwards;
}
@keyframes firecracker {
0% {
transform: translate(0, 0) scale(0);
opacity: 1;
}
100% {
transform: translate(var(--x), var(--y)) scale(1.5);
opacity: 0;
}
}
/* çˆ†ç‚¸ç‰¹æ•ˆæ¨£å¼ */
.explosion-container {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: 1000;
}
.explosion-particle {
position: absolute;
width: 6px;
height: 6px;
border-radius: 50%;
animation: explosion 1s ease-out forwards;
}
@keyframes explosion {
0% {
transform: translate(0, 0) scale(1);
opacity: 1;
}
50% {
transform: translate(var(--x), var(--y)) scale(1.5);
opacity: 0.8;
}
100% {
transform: translate(var(--x), var(--y)) scale(0);
opacity: 0;
}
}
.explosion-flash {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(255, 255, 255, 0.8);
pointer-events: none;
z-index: 999;
animation: flash 0.3s ease-out;
}
@keyframes flash {
0% { opacity: 0; }
50% { opacity: 1; }
100% { opacity: 0; }
}
</style>
</head>
<body>
<h1 id="header">æ±ºæˆ°ï¼æ˜æ™ºäº”å­æ£‹ï¼</h1>
<div id="status">é»‘æ£‹å›åˆ</div>

<!-- è¨ˆæ™‚å™¨å®¹å™¨ -->
<div id="timer-container" style="display: none;">
<div class="timer-box black-timer active" id="blackTimer">
<div class="timer-label">é»‘æ£‹æ™‚é–“</div>
<div class="timer-time" id="blackTime">5:00</div>
</div>
<div class="timer-box white-timer" id="whiteTimer">
<div class="timer-label">ç™½æ£‹æ™‚é–“</div>
<div class="timer-time" id="whiteTime">5:00</div>
</div>
</div>

<div id="controls">
<button class="undo" onclick="undoMove()">æ‚”æ£‹</button>
<button class="reset" onclick="resetGame()">æ–°éŠæˆ²</button>
<button id="markToggle" onclick="toggleMarking()">é–‹å•Ÿè¨»è¨˜</button>
<button id="forbiddenToggle" onclick="toggleForbiddenDetection()">é–‹å•Ÿç¦æ‰‹æª¢æ¸¬</button>
<button id="timerToggle" onclick="toggleTimer()">é–‹å•Ÿè¨ˆæ™‚</button>
<button id="pauseResumeTimer" onclick="togglePauseTimer()" style="display: none;">æš«åœè¨ˆæ™‚</button>
</div>
<table id="board"></table>
<div id="rules">
<h3>éŠæˆ²è¦å‰‡ï¼š</h3>
<ul>
<li>ğŸª ç‡ˆç‰Œæ’éšŠé€£ç·š</li>
<li>ğŸ’ è´ŠåŠ©50 æ’éšŠ&å¾©æ´»</li>
<li>ğŸ¤ è´ä¸»æ’­éš¨æ©Ÿè¡¨æ¼”æ‰è—</li>
<li>ğŸš«ç¦æ­¢å·å·ä½¿ç”¨AIä»£ä¸‹</li>
<li>âš« é»‘æ£‹ç¦æ‰‹ï¼šï¼ˆä¸‹äº†å°±ç®—è¼¸ï¼Œå¯ç¦å¯ä¸ç¦ï¼‰
<ul><li>ç¦æ­¢é›™æ´»ä¸‰ï¼ˆåŒæ™‚å½¢æˆå…©å€‹æ´»ä¸‰ï¼‰</li>
<li>ç¦æ­¢é›™å››ï¼ˆåŒæ™‚å½¢æˆå…©å€‹å››ï¼‰</li>
<li>ç¦æ­¢é•·é€£ï¼ˆè¶…éäº”å­é€£ç·šï¼‰</li>
</ul>
</li>
<li>âšª ç™½æ£‹ç„¡ä»»ä½•é™åˆ¶</li>
<li>â³åˆè¨ˆä¸‹æ»¿100æ‰‹è‡ªå‹•åˆæ£‹</li>
<li>â° æ¯äººæ€è€ƒæ™‚é–“5åˆ†é˜ï¼Œæ¯æ‰‹+3ç§’ï¼Œæ™‚é–“è€—ç›¡ç›´æ¥è½æ•—</li>
</ul>
</div>
<script>
const BOARD_SIZE = 15;
let currentPlayer = 1;
let boardData = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(0));
let moveHistory = [];
let stepNumber = 1;
let isMarking = false;
let isForbiddenDetectionEnabled = false;
let prePlacePosition = null;
let numberMatrix = generateSpiralMatrix(BOARD_SIZE);
let gameOver = false;

// è¨ˆæ™‚å™¨ç›¸é—œè®Šæ•¸
let isTimerEnabled = false;
let isPaused = false;
let blackTimeRemaining = 300; // 5åˆ†é˜ = 300ç§’
let whiteTimeRemaining = 300; // 5åˆ†é˜ = 300ç§’
let timerInterval = null;

// Audio context for sound generation
let audioContext;

// åˆå§‹åŒ–éŸ³é »ä¸Šä¸‹æ–‡
function initAudioContext() {
if (!audioContext) {
audioContext = new (window.AudioContext || window.webkitAudioContext)();
}
}

// ç”Ÿæˆä¸‹æ£‹è²éŸ³
function playMoveSound() {
initAudioContext();
const oscillator = audioContext.createOscillator();
const gainNode = audioContext.createGain();
const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.1,
audioContext.sampleRate);
const noiseData = noiseBuffer.getChannelData(0);
// ç”Ÿæˆç™½å™ªéŸ³
for (let i = 0; i < noiseData.length; i++) {
noiseData[i] = (Math.random() * 2 - 1) * 0.3;
}
const noiseSource = audioContext.createBufferSource();
noiseSource.buffer = noiseBuffer;
const filter = audioContext.createBiquadFilter();
filter.type = 'highpass';
filter.frequency.value = 800;
// è¨­ç½®éŸ³é‡åŒ…çµ¡
gainNode.gain.setValueAtTime(0.8, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.08);
noiseSource.connect(filter);
filter.connect(gainNode);
gainNode.connect(audioContext.destination);
noiseSource.start();
noiseSource.stop(audioContext.currentTime + 0.08);
}

// ç”Ÿæˆå‹åˆ©éŸ³æ•ˆï¼ˆæ…¶ç¥éŸ³æ¨‚ï¼‰
function playVictorySound() {
initAudioContext();
const duration = 2;
const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
const data = buffer.getChannelData(0);

// ç”Ÿæˆå‹åˆ©æ—‹å¾‹
for (let i = 0; i < data.length; i++) {
const time = i / audioContext.sampleRate;
// ä¸»æ—‹å¾‹ï¼ˆCå¤§èª¿éŸ³éšä¸Šè¡Œï¼‰
const frequencies = [523.25, 587.33, 659.25, 698.46, 783.99]; // C5, D5, E5, F5, G5
const noteIndex = Math.floor(time * 5) % frequencies.length;
const freq = frequencies[noteIndex];
// ç”ŸæˆéŸ³ç¬¦
const noteValue = Math.sin(time * freq * 2 * Math.PI) * 0.3;
// åŠ å…¥å’Œè²
const harmonyValue = Math.sin(time * freq * 1.5 * 2 * Math.PI) * 0.15;
// åŒ…çµ¡ç·š
const envelope = Math.exp(-time * 0.8);
data[i] = (noteValue + harmonyValue) * envelope;
}

const source = audioContext.createBufferSource();
source.buffer = buffer;
const gainNode = audioContext.createGain();
gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.1, audioContext.currentTime + duration);
source.connect(gainNode);
gainNode.connect(audioContext.destination);
source.start();
}

// ç”Ÿæˆåœ°é›·çˆ†ç‚¸è²éŸ³ï¼ˆåŠ å¼·ç‰ˆï¼‰
function playExplosionSound() {
initAudioContext();
const duration = 1.2;
const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
const data = buffer.getChannelData(0);

// ç”Ÿæˆå¼·çƒˆçš„çˆ†ç‚¸è²éŸ³
for (let i = 0; i < data.length; i++) {
const time = i / audioContext.sampleRate;
const decay = Math.exp(-time * 3);
// ä½é »çˆ†ç‚¸è²ï¼ˆåƒåœ°é›·ä¸€æ¨£çš„è½Ÿéš†è²ï¼‰
const lowFreqNoise = (Math.random() * 2 - 1) * decay * 1.2;
// é«˜é »ç ´ç¢è²
const highFreqNoise = (Math.random() * 2 - 1) * decay * 0.8 * Math.exp(-time * 8);
// è¡æ“Šæ³¢æ•ˆæœï¼ˆä½é »éœ‡å‹•ï¼‰
const shockWave = Math.sin(time * 40 * (1 - time * 0.5)) * decay * 0.6;
data[i] = (lowFreqNoise + highFreqNoise + shockWave);
}

const source = audioContext.createBufferSource();
source.buffer = buffer;
const filter = audioContext.createBiquadFilter();
filter.type = 'lowpass';
filter.frequency.value = 200; // æ›´ä½é »ï¼Œæ›´æœ‰åœ°é›·çˆ†ç‚¸çš„æ„Ÿè¦º
const gainNode = audioContext.createGain();
gainNode.gain.setValueAtTime(2.0, audioContext.currentTime); // å¤§å¹…å¢åŠ éŸ³é‡
gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
source.connect(filter);
filter.connect(gainNode);
gainNode.connect(audioContext.destination);
source.start();
}

// è¨ˆæ™‚å™¨ç›¸é—œå‡½æ•¸
function toggleTimer() {
isTimerEnabled = !isTimerEnabled;
const button = document.getElementById('timerToggle');
const timerContainer = document.getElementById('timer-container');
const pauseButton = document.getElementById('pauseResumeTimer');
if (isTimerEnabled) {
button.textContent = 'é—œé–‰è¨ˆæ™‚';
timerContainer.style.display = 'flex';
pauseButton.style.display = 'inline-block';
startTimer();
} else {
button.textContent = 'é–‹å•Ÿè¨ˆæ™‚';
timerContainer.style.display = 'none';
pauseButton.style.display = 'none';
stopTimer();
}
}

function togglePauseTimer() {
if (!isTimerEnabled) return;
isPaused = !isPaused;
const button = document.getElementById('pauseResumeTimer');
if (isPaused) {
button.textContent = 'ç¹¼çºŒè¨ˆæ™‚';
stopTimer();
} else {
button.textContent = 'æš«åœè¨ˆæ™‚';
startTimer();
}
}

function startTimer() {
if (timerInterval) clearInterval(timerInterval);
timerInterval = setInterval(updateTimer, 1000);
}

function stopTimer() {
if (timerInterval) {
clearInterval(timerInterval);
timerInterval = null;
}
}

function updateTimer() {
if (gameOver || isPaused) return;

if (currentPlayer === 1) {
blackTimeRemaining--;
if (blackTimeRemaining <= 0) {
gameOver = true;
stopTimer();
alert("é»‘æ£‹æ™‚é–“ç”¨å®Œï¼ç™½æ£‹ç²å‹ï¼");
updateStatus("ç™½æ£‹ç²å‹ï¼ˆé»‘æ£‹è¶…æ™‚ï¼‰");
return;
}
} else {
whiteTimeRemaining--;
if (whiteTimeRemaining <= 0) {
gameOver = true;
stopTimer();
alert("ç™½æ£‹æ™‚é–“ç”¨å®Œï¼é»‘æ£‹ç²å‹ï¼");
updateStatus("é»‘æ£‹ç²å‹ï¼ˆç™½æ£‹è¶…æ™‚ï¼‰");
return;
}
}
updateTimerDisplay();
}

function updateTimerDisplay() {
const blackTimeElement = document.getElementById('blackTime');
const whiteTimeElement = document.getElementById('whiteTime');
const blackTimerBox = document.getElementById('blackTimer');
const whiteTimerBox = document.getElementById('whiteTimer');

// æ ¼å¼åŒ–æ™‚é–“é¡¯ç¤º
blackTimeElement.textContent = formatTime(blackTimeRemaining);
whiteTimeElement.textContent = formatTime(whiteTimeRemaining);

// æ›´æ–°æ´»èºç‹€æ…‹
if (currentPlayer === 1) {
blackTimerBox.classList.add('active');
whiteTimerBox.classList.remove('active');
} else {
blackTimerBox.classList.remove('active');
whiteTimerBox.classList.add('active');
}

// æ™‚é–“ä¸è¶³è­¦å‘Šï¼ˆå°‘æ–¼30ç§’æ™‚é¡¯ç¤ºç´…è‰²ï¼‰
if (blackTimeRemaining <= 30) {
blackTimeElement.classList.add('timer-low');
} else {
blackTimeElement.classList.remove('timer-low');
}

if (whiteTimeRemaining <= 30) {
whiteTimeElement.classList.add('timer-low');
} else {
whiteTimeElement.classList.remove('timer-low');
}
}

function formatTime(seconds) {
const minutes = Math.floor(seconds / 60);
const remainingSeconds = seconds % 60;
return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

function addTimeBonus() {
// æ¯ä¸‹ä¸€å­å¢åŠ 3ç§’
if (currentPlayer === 1) {
blackTimeRemaining += 3;
} else {
whiteTimeRemaining += 3;
}
}

function generateSpiralMatrix(size) {
let matrix = Array(size).fill().map(() => Array(size).fill(0));
let directions = [[0, 1], [1, 0], [0, -1], [-1, 0]];
let currentDir = 0;
let row = Math.floor(size/2);
let col = Math.floor(size/2);
let steps = 1;
let num = 1;
while(num <= size*size) {
for(let i = 0; i < 2; i++) {
for(let j = 0; j < steps; j++) {
if(num > size*size) break;
matrix[row][col] = num++;
row += directions[currentDir][0];
col += directions[currentDir][1];
}
currentDir = (currentDir + 1) % 4;
}
steps++;
}
return matrix;
}

function createBoard() {
const board = document.getElementById('board');
board.innerHTML = '';
for(let i = 0; i < BOARD_SIZE; i++) {
const tr = document.createElement('tr');
for(let j = 0; j < BOARD_SIZE; j++) {
const td = document.createElement('td');
td.textContent = numberMatrix[i][j];
td.addEventListener('click', function() {
const row = i;
const col = j;
if (isMarking) {
this.classList.toggle('mark');
} else {
handleNormalClick(row, col, this);
}
});
tr.appendChild(td);
}
board.appendChild(tr);
}
}

function handleNormalClick(row, col, cell) {
if (boardData[row][col] !== 0 || gameOver) return;
if (prePlacePosition) {
if (prePlacePosition.row === row && prePlacePosition.col === col) {
// æª¢æŸ¥é»‘æ£‹ç¦æ‰‹
if (currentPlayer === 1 && isForbiddenDetectionEnabled && isForbiddenMove(row, col)) {
// ç§»é™¤é è¦½
cell.classList.remove('preview');
prePlacePosition = null;
// æ’­æ”¾çˆ†ç‚¸è²éŸ³
playExplosionSound();
// é¡¯ç¤ºçˆ†ç‚¸ç‰¹æ•ˆ
showExplosionAnimation(cell);
// ç¢ºå¯¦è½å­ä½†å‘ˆç¾ç‰¹æ®Šæ¨£å¼
placeForbiddenStone(row, col);
// å»¶é²é¡¯ç¤ºæç¤ºï¼Œè®“çˆ†ç‚¸ç‰¹æ•ˆå…ˆæ’­æ”¾
setTimeout(() => {
alert("é»‘æ£‹ä¸‹äº†ç¦æ‰‹ï¼ç™½æ£‹ç²å‹ï¼");
gameOver = true;
updateStatus("ç™½æ£‹ç²å‹ï¼ˆé»‘æ£‹ç¦æ‰‹ï¼‰");
stopTimer();
}, 800);
return;
}
placeStone(row, col);
cell.classList.remove('preview');
prePlacePosition = null;
} else {
document.querySelector(`#board tr:nth-child(${prePlacePosition.row+1}) td:nth-child(${prePlacePosition.col+1})`).classList.remove('preview');
cell.classList.add('preview');
prePlacePosition = {row, col};
}
} else {
cell.classList.add('preview');
prePlacePosition = {row, col};
}
}

// é¡¯ç¤ºçˆ†ç‚¸å‹•ç•«
function showExplosionAnimation(targetCell) {
// æ·»åŠ é–ƒå…‰æ•ˆæœ
const flash = document.createElement('div');
flash.className = 'explosion-flash';
document.body.appendChild(flash);
// å‰µå»ºçˆ†ç‚¸å®¹å™¨
const container = document.createElement('div');
container.className = 'explosion-container';
document.body.appendChild(container);
// ç²å–ç›®æ¨™æ ¼å­çš„ä½ç½®
const rect = targetCell.getBoundingClientRect();
const centerX = rect.left + rect.width / 2;
const centerY = rect.top + rect.height / 2;
// æ·»åŠ çˆ†ç‚¸ç²’å­
for (let i = 0; i < 50; i++) {
const particle = document.createElement('div');
particle.className = 'explosion-particle';
// è¨­ç½®ç²’å­èµ·å§‹ä½ç½®
particle.style.left = `${centerX}px`;
particle.style.top = `${centerY}px`;
// çˆ†ç‚¸é¡è‰²ï¼ˆç´…ã€æ©™ã€é»ƒï¼‰
const colors = ['#ff0000', '#ff4500', '#ffa500', '#ffff00', '#ff6600'];
particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
// è¨­ç½®éš¨æ©Ÿçˆ†ç‚¸æ–¹å‘ï¼ˆæ›´é›†ä¸­çš„çˆ†ç‚¸æ•ˆæœï¼‰
const angle = Math.random() * Math.PI * 2;
const distance = Math.random() * 150 + 50;
const x = Math.cos(angle) * distance;
const y = Math.sin(angle) * distance;
particle.style.setProperty('--x', `${x}px`);
particle.style.setProperty('--y', `${y}px`);
container.appendChild(particle);
}
// ç§»é™¤å‹•ç•«å…ƒç´ 
setTimeout(() => {
flash.remove();
container.remove();
}, 1000);
}

function placeForbiddenStone(row, col) {
// è¨˜éŒ„ç¦æ‰‹æ£‹æ­¥
moveHistory.push({
row: row,
col: col,
player: currentPlayer,
step: stepNumber,
forbidden: true
});
const cell = document.querySelector(`#board tr:nth-child(${row+1}) td:nth-child(${col+1})`);
cell.classList.add('forbidden-stone', 'forbidden');
const numberSpan = document.createElement('span');
numberSpan.className = 'move-number';
numberSpan.textContent = stepNumber;
cell.appendChild(numberSpan);
boardData[row][col] = currentPlayer;
stepNumber++;
}

function placeStone(row, col) {
if (gameOver) return;
document.querySelector(`#board tr:nth-child(${row+1}) td:nth-child(${col+1})`).classList.remove('preview', 'forbidden');
moveHistory.push({
row: row,
col: col,
player: currentPlayer,
step: stepNumber
});
const cell = document.querySelector(`#board tr:nth-child(${row+1}) td:nth-child(${col+1})`);
cell.classList.add(currentPlayer === 1 ? 'black' : 'white');
// æ’­æ”¾ä¸‹æ£‹è²éŸ³
playMoveSound();
const numberSpan = document.createElement('span');
numberSpan.className = 'move-number';
numberSpan.textContent = stepNumber;
cell.appendChild(numberSpan);
boardData[row][col] = currentPlayer;

// æ·»åŠ æ™‚é–“çå‹µ
if (isTimerEnabled) {
addTimeBonus();
}

// æª¢æŸ¥æ˜¯å¦ç²å‹
const winningPositions = checkWin(row, col);
if (winningPositions) {
// é«˜äº®ç²å‹çš„æ£‹å­
highlightWinningStones(winningPositions);
// æ’­æ”¾å‹åˆ©éŸ³æ•ˆ
playVictorySound();
// é¡¯ç¤ºé­ç‚®å‹•ç•«
showFirecrackerAnimation();
// éŠæˆ²çµæŸ
gameOver = true;
// åœæ­¢è¨ˆæ™‚å™¨
stopTimer();
// æ›´æ–°ç‹€æ…‹
updateStatus(`${currentPlayer === 1 ? 'é»‘æ£‹' : 'ç™½æ£‹'}ç²å‹ï¼`);
// é¡¯ç¤ºæç¤º
setTimeout(() => {
alert(`${currentPlayer === 1 ? 'é»‘æ£‹' : 'ç™½æ£‹'}ç²å‹ï¼`);
}, 300);
return;
}
stepNumber++;
currentPlayer = currentPlayer === 1 ? 2 : 1;
updateStatus();
updateTimerDisplay();
// Update forbidden positions after a move
if (isForbiddenDetectionEnabled) {
updateForbiddenPositions();
}
}

// æª¢æŸ¥ç²å‹æ¢ä»¶
function checkWin(row, col) {
const player = boardData[row][col];
if (player === 0) return false;
const directions = [
[0, 1], // horizontal
[1, 0], // vertical
[1, 1], // diagonal down-right
[1, -1] // diagonal down-left
];
for (const [dx, dy] of directions) {
let count = 1; // count the current stone
let winningPositions = [[row, col]]; // store positions of winning stones
// Check in positive direction
let r = row + dx;
let c = col + dy;
while (r >= 0 && r < BOARD_SIZE && c >= 0 && c < BOARD_
